# DDLS-in-Python

Depolarized Dynamic Light Scattering (DDLS) data analysis in Python. Used to determine the aspect ratio (and derived length/width) of non-spherical nanoparticles via fitting experimental data to oblate, prolate, or cylinder models (based on translational/rotational diffusion coefficients). 

Features:
- CLI-driven: add experimental data, select model/solver/plot options.
- Error tracking: warnings/errors logged to `ddls_warnings.log`/`ddls_errors.log` (shown on CLI); data dict errors tracked from load.
- Src layout for Python packaging.
- Unit tests (runnable in one line).
- Plotting: 3D interactive HTML (auto-open) or PNG; comparison bar figure for solvers in "compare" mode.
- Modern solver: `scipy.optimize.root` (hybr default; options + perf compare/timing).

Sample outputs (3D interactive generated by Plotly):
- http://htmlpreview.github.io/?https://github.com/JacobHA/DDLS-in-Python/master/prolate_5.143347.html
- http://htmlpreview.github.io/?https://github.com/JacobHA/DDLS-in-Python/master/prolate_6.289547.html
- http://htmlpreview.github.io/?https://github.com/JacobHA/DDLS-in-Python/master/prolate_8.440575.html

Project structure (src layout):
- `src/ddls/`: core modules (Calculations, geometric funcs, data I/O, plotting, etc.).
- `Parent.py`: main CLI entry.
- `tests/`: unit tests.
- `pyproject.toml` + `requirements.txt`: deps (for uv/pip).
- Data: `sample_data.txt`; logs: `ddls_*.log`; outputs: `*.html`/`*png`, solver compare figs.

## Dependencies
- Runtime: numpy, scipy, plotly, kaleido (for PNG export; statistics stdlib). See `pyproject.toml`/`requirements.txt`.
- Dev/tests: pytest (via `uv sync --dev`).

## CLI Usage Steps
1. **Setup**:
   - Clone/download repo.
   - Install uv: see https://docs.astral.sh/uv/getting-started/installation/
   - `uv sync --dev` (creates `.venv/`, installs deps + pytest, generates `uv.lock`).
   - Activate: `source .venv/bin/activate` (Linux/Mac) or `uv run ...` for commands.

2. **Run CLI** (`python Parent.py` or `uv run python Parent.py`):
   - **STEP 1**: Prompt for new dataset? (`yes`/other). If yes â†’ data entry loop (detailed below).
   - **STEP 3**: List sample names from `sample_data.txt`; enter one (e.g. "stocksAndrew").
   - **STEP 4**: Loop over dataset? (`1` for batch / other for single).
     - If single: enter sample # from list.
   - **STEP 5**: Enter model (`prolate`/`oblate`/`cylinder`).
   - **STEP 5.5**: Solver (`hybr` default / `lm` / `compare` for both + timing/perf compare; broyden1 removed due to errors).
   - **STEP 6**: Plot format (`html` for interactive+auto-open / `png`); if png enter path (default cwd).
   - On "compare" solver: CLI shows per-solver aspect/L/W + times; auto-generates bar comparison figure.

   **Expected CLI output example** (abbrev; full logs errors/warnings to files):
   ```
   The possible names are: 
   stocksAndrew
   ...
   STEP 3: Enter the desired sample name...
   STEP 4: If you would like to loop...
   STEP 5: Enter the model...
   STEP 5.5: Choose solver...
   STEP 6: For the plotting...
   Comparing all solvers for prolate model...
     hybr solver -> Aspect ratio: 5.143, Length: ..., Time: 0.1234s
     ...
   Using 'hybr' for final...
   Aspect ratio (for prolate model, hybr solver): 5.143
   Length: ... nm
   Width: ... nm
   File saved at ...prolate_5.143.html
   Compare figure saved at ...prolate_solvers_compare.html
   ```
   - Errors: printed + logged (e.g. "Error adding data to dictionary...").
   - Warnings: shown on CLI + `ddls_warnings.log`.
   - If add data (yes): interactive prompts for dataset name/rows (format: title,temp,D_tr,D_rot); ends with "stop". Re-run to analyze.

3. **Outputs**:
   - CLI: aspect ratio, L/W (nm), solver times (in compare), file save paths, errors/warnings.
   - Files: 3D shape (HTML/PNG in cwd or specified), optional solver compare bar fig, logs.
   - Data: appended to `sample_data.txt` (dict for fitting).

## Tests
- Run all: `uv run pytest` (or `python -m unittest discover -s tests`).
- Covers geometric funcs, data I/O, solver smoke tests (expand as needed).

### TODO
- More geometries (e.g. star-shaped, coils).
- Executable interface (e.g. CLI app).
